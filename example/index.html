<!doctype html>
<html>
<head>
  <meta charset='utf8'>
  <title>An example CrossBone app</title>
  <link rel="stylesheet" href="style.css" type="text/css" media="screen">
  
</head>

  <h1>CrossBone</h1>


  <div id="charts">
    <div id="pie-chart" class="chart">
      <div class="title">Time of Day</div>
    </div>
    

    <div id="data-count">
      <span class="filtered"></span> selected from <span class="total"></span>
    </div>

  </div>

  <script src="../test/vendor/jquery.js"></script>
  <script src="../test/vendor/underscore.js"></script>
  <script src="../test/vendor/backbone.js"></script>
  <script src="../test/vendor/d3.js"></script>
  <script src="../test/vendor/crossfilter.js"></script>
  <script src="backbone.localstorage.js"></script>
  <script src="../crossbone.js"></script>



  <script>


    d3.csv("flights-3m.json", function( data ) {

      data.forEach(function(d, i) {
        d.date = parseDate(d.date);
        d.delay = +d.delay;
        d.distance = +d.distance;
        d.index = i;
      })

      var crossbone = new CrossBone(data);

      crossbone.dataChart('#data-count', {
        dimension: crossbone.all(),
        group: crossbone.groupAll()
      });

      var hour = crossbone.dimension(function(d) { 
        return d.date.getHours() + d.date.getMinutes() / 60; 
      })
      var hours = hour.group(Math.floor);

      crossbone.pieChart('#pie-chart', {
        dimension: hour,
        group: hours
      })


      crossbone.renderAll();

    });

    function parseDate(d) {
      return new Date(2001, 
        d.substring(0, 2) -1,
        d.substring(2, 4),
        d.substring(4, 6),
        d.substring(6, 8));
    }

    
  
  </script>

</html>